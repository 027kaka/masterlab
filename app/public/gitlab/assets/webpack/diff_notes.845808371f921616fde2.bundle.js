webpackJsonp([10],{"/hXC":function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("JTVE");!function(){var e=n.default.extend({props:{discussionId:{type:String,required:!0}},data:function(){return{discussions:CommentsStore.state}},computed:{discussion:function(){return this.discussions[this.discussionId]},showButton:function(){return!!this.discussion&&!this.discussion.isResolved()}}});n.default.component("new-issue-for-discussion-btn",e)}()},EuiY:function(e,s,t){"use strict";(function(e){Object.defineProperty(s,"__esModule",{value:!0});var n=t("JTVE");t("ZZAo"),t("epgj"),t("zKIA"),t("G+9o"),t("SVCF"),t("rK+X"),t("WYUY"),t("MU9e"),t("cRac"),t("tExy"),t("TP7M"),t("/hXC"),e(function(){var s=document.querySelector(".merge-request").dataset.projectPath;window.gl=window.gl||{},window.gl.diffNoteApps={},window.ResolveService=new gl.DiffNotesResolveServiceClass(s),gl.diffNotesCompileComponents=function(){e("diff-note-avatars").each(function(){var s=n.default.extend({template:e(this).get(0).outerHTML}),t=(new s).$mount();e(this).replaceWith(t.$el)});var s=e("resolve-btn, resolve-discussion-btn, jump-to-discussion, comment-and-resolve-btn, new-issue-for-discussion-btn").filter(function(){return 1!==e(this).closest("resolve-count").length});s&&s.each(function(){var s=e(this),t=s.attr(":note-id"),o=n.default.extend({template:s.get(0).outerHTML}),i=(new o).$mount();t&&(gl.diffNoteApps["note_"+t]=i),s.replaceWith(i.$el)})},gl.diffNotesCompileComponents(),new n.default({el:"#resolve-count-app",components:{"resolve-count":ResolveCount}})})}).call(s,t("lwLq"))},"G+9o":function(e,s,t){"use strict";function n(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(s,"__esModule",{value:!0});var o=t("JTVE"),i=t("7UJR"),u=t.n(i),r=function(){function e(e,s){for(var t=0;t<s.length;t++){var n=s[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(s,t,n){return t&&e(s.prototype,t),n&&e(s,n),s}}();t("wFzz"),o.default.use(u.a),function(){window.gl=window.gl||{};var e=function(){function e(s){n(this,e),this.noteResource=o.default.resource(s+"/notes{/noteId}/resolve"),this.discussionResource=o.default.resource(s+"/merge_requests{/mergeRequestId}/discussions{/discussionId}/resolve")}return r(e,[{key:"resolve",value:function(e){return this.noteResource.save({noteId:e},{})}},{key:"unresolve",value:function(e){return this.noteResource.delete({noteId:e},{})}},{key:"toggleResolveForDiscussion",value:function(e,s){var t=CommentsStore.state[s],n=t.isResolved(),o=void 0;o=n?this.unResolveAll(e,s):this.resolveAll(e,s),o.then(function(e){if(t.loading=!1,200===e.status){var s=e.json(),o=s?s.resolved_by:null;n?t.unResolveAllNotes():t.resolveAllNotes(o),t.updateHeadline(s)}else new Flash("An error occurred when trying to resolve a discussion. Please try again.","alert")})}},{key:"resolveAll",value:function(e,s){return CommentsStore.state[s].loading=!0,this.discussionResource.save({mergeRequestId:e,discussionId:s},{})}},{key:"unResolveAll",value:function(e,s){return CommentsStore.state[s].loading=!0,this.discussionResource.delete({mergeRequestId:e,discussionId:s},{})}}]),e}();gl.DiffNotesResolveServiceClass=e}()},MU9e:function(e,s,t){"use strict";(function(e){Object.defineProperty(s,"__esModule",{value:!0});var n=t("JTVE");!function(){var s=n.default.extend({props:{noteId:Number,discussionId:String,resolved:Boolean,canResolve:Boolean,resolvedBy:String,authorName:String,authorAvatar:String,noteTruncated:String},data:function(){return{discussions:CommentsStore.state,loading:!1,note:{}}},watch:{discussions:{handler:"updateTooltip",deep:!0}},computed:{discussion:function(){return this.discussions[this.discussionId]},buttonText:function(){return this.isResolved?"Resolved by "+this.resolvedByName:this.canResolve?"Mark as resolved":"Unable to resolve"},isResolved:function(){return!!this.note&&this.note.resolved},resolvedByName:function(){return this.note.resolved_by}},methods:{updateTooltip:function(){var s=this;this.$nextTick(function(){e(s.$refs.button).tooltip("hide").tooltip("fixTitle")})},resolve:function(){var e=this;if(this.canResolve){var s=void 0;this.loading=!0,s=this.isResolved?ResolveService.unresolve(this.noteId):ResolveService.resolve(this.noteId),s.then(function(s){if(e.loading=!1,200===s.status){var t=s.json(),n=t?t.resolved_by:null;CommentsStore.update(e.discussionId,e.noteId,!e.isResolved,n),e.discussion.updateHeadline(t)}else new Flash("An error occurred when trying to resolve a comment. Please try again.","alert");e.updateTooltip()})}}},mounted:function(){e(this.$refs.button).tooltip({container:"body"})},beforeDestroy:function(){CommentsStore.delete(this.discussionId,this.noteId)},created:function(){CommentsStore.create({discussionId:this.discussionId,noteId:this.noteId,canResolve:this.canResolve,resolved:this.resolved,resolvedBy:this.resolvedBy,authorName:this.authorName,authorAvatar:this.authorAvatar,noteTruncated:this.noteTruncated}),this.note=this.discussion.getNote(this.noteId)}});n.default.component("resolve-btn",s)}()}).call(s,t("lwLq"))},SVCF:function(e,s){!function(e){e.DiscussionMixins={computed:{discussionCount:function(){return Object.keys(this.discussions).length},resolvedDiscussionCount:function(){var e=0;for(var s in this.discussions){this.discussions[s].isResolved()&&(e+=1)}return e},unresolvedDiscussionCount:function(){var e=0;for(var s in this.discussions){this.discussions[s].isResolved()||(e+=1)}return e}}}}(window)},TP7M:function(e,s,t){"use strict";(function(e){Object.defineProperty(s,"__esModule",{value:!0});var n=t("JTVE"),o=t("gL/p"),i=t.n(o);!function(){var s=n.default.extend({props:["discussionId"],data:function(){return{isVisible:!1,lineType:"",storeState:CommentsStore.state,shownAvatars:3,collapseIcon:i.a}},template:'\n      <div class="diff-comment-avatar-holders"\n        v-show="notesCount !== 0">\n        <div v-if="!isVisible">\n          <img v-for="note in notesSubset"\n            class="avatar diff-comment-avatar has-tooltip js-diff-comment-avatar"\n            width="19"\n            height="19"\n            role="button"\n            data-container="body"\n            data-placement="top"\n            data-html="true"\n            :data-line-type="lineType"\n            :title="note.authorName + \': \' + note.noteTruncated"\n            :src="note.authorAvatar"\n            @click="clickedAvatar($event)" />\n          <span v-if="notesCount > shownAvatars"\n            class="diff-comments-more-count has-tooltip js-diff-comment-avatar"\n            data-container="body"\n            data-placement="top"\n            ref="extraComments"\n            role="button"\n            :data-line-type="lineType"\n            :title="extraNotesTitle"\n            @click="clickedAvatar($event)">{{ moreText }}</span>\n        </div>\n        <button class="diff-notes-collapse js-diff-comment-avatar"\n          type="button"\n          aria-label="Show comments"\n          :data-line-type="lineType"\n          @click="clickedAvatar($event)"\n          v-if="isVisible"\n          v-html="collapseIcon">\n        </button>\n      </div>\n    ',mounted:function(){var s=this;this.$nextTick(function(){s.addNoCommentClass(),s.setDiscussionVisible(),s.lineType=e(s.$el).closest(".diff-line-num").hasClass("old_line")?"old":"new"}),e(document).on("toggle.comments",function(){s.$nextTick(function(){s.setDiscussionVisible()})})},destroyed:function(){e(document).off("toggle.comments")},watch:{storeState:{handler:function(){var s=this;this.$nextTick(function(){e(".has-tooltip",s.$el).tooltip("fixTitle"),s.addNoCommentClass()})},deep:!0}},computed:{notesSubset:function(){var e=this,s=[];return this.discussion&&(s=Object.keys(this.discussion.notes).slice(0,this.shownAvatars).map(function(s){return e.discussion.notes[s]})),s},extraNotesTitle:function(){if(this.discussion){var e=this.discussion.notesCount()-this.shownAvatars;return e+" more comment"+(e>1?"s":"")}return""},discussion:function(){return this.storeState[this.discussionId]},notesCount:function(){return this.discussion?this.discussion.notesCount():0},moreText:function(){return(this.notesCount<100?"+":"")+(this.notesCount-this.shownAvatars)}},methods:{clickedAvatar:function(s){var t=this;notes.addDiffNote(s),this.toggleDiscussionsToggleState(),this.$nextTick(function(){t.setDiscussionVisible(),e(".has-tooltip",t.$el).tooltip("fixTitle"),e(".has-tooltip",t.$el).tooltip("hide")})},addNoCommentClass:function(){var s=this.notesCount;e(this.$el).closest(".js-avatar-container").toggleClass("js-no-comment-btn",s>0).nextUntil(".js-avatar-container").toggleClass("js-no-comment-btn",s>0)},toggleDiscussionsToggleState:function(){var s=e(this.$el).closest(".code").find(".notes_holder"),t=s.filter(":visible");e(this.$el).closest(".diff-file").find(".js-toggle-diff-comments").toggleClass("active",s.length===t.length)},setDiscussionVisible:function(){this.isVisible=e('.diffs .notes[data-discussion-id="'+this.discussion.id+'"]').is(":visible")}}});n.default.component("diff-note-avatars",s)}()}).call(s,t("lwLq"))},WYUY:function(e,s,t){"use strict";(function(e){Object.defineProperty(s,"__esModule",{value:!0});var n=t("JTVE");!function(){var s=n.default.extend({mixins:[DiscussionMixins],props:{discussionId:String},data:function(){return{discussions:CommentsStore.state,discussion:{}}},computed:{allResolved:function(){return 0===this.unresolvedDiscussionCount},showButton:function(){return this.discussionId?this.unresolvedDiscussionCount>1||this.discussionId!==this.lastResolvedId:this.unresolvedDiscussionCount>=1},lastResolvedId:function(){var e=void 0;for(var s in this.discussions){var t=this.discussions[s];t.isResolved()||(e=t.id)}return e}},methods:{jumpToNextUnresolvedDiscussion:function(){var s=void 0,t=void 0,n=void 0,o=void 0,i=window.mrTabs.currentAction,u=!0,r=!this.discussionId,a=function(s){return s.map(function(){return e(this).attr("data-discussion-id")}).toArray()},d=this.discussions;if("diffs"===i){s=".diffs .notes[data-discussion-id]",t=a(e(s));for(var c=0,l=0;l<t.length;l+=1){var f=t[l],v=d[f];v&&!v.isResolved()&&(c+=1)}this.discussionId&&!this.discussion.isResolved()?1===c&&(u=!1):0===c&&(u=!1)}else"notes"!==i&&(u=!1);u||(window.mrTabs.activateTab("notes"),i="notes",r=!0),"notes"===i&&(s=".discussion[data-discussion-id]",t=a(e(s)));for(var h=!1,m=0;m<t.length;m+=1){var p=t[m],g=d[p];if(g){if(!n&&!g.isResolved()&&(n=p,r))break;if(!r){if(h){if(g.isResolved())continue;o=p;break}p===this.discussionId&&(h=!0)}}}if(o=o||n){var b=e(s+'[data-discussion-id="'+o+'"]');if("notes"===i)b=b.closest(".note-discussion"),b.find(".js-toggle-content").is(":hidden")&&b.find(".js-toggle-button i").trigger("click");else if("diffs"===i){b.closest(".content").show(),b=b.closest("tr.notes_holder"),b.show();for(var C=void 0,y=0;y<4&&(C=b.prev(),C.hasClass("line_holder"));y+=1)b=C}e.scrollTo(b,{offset:0})}}},created:function(){this.discussion=this.discussions[this.discussionId]}});n.default.component("jump-to-discussion",s)}()}).call(s,t("lwLq"))},ZZAo:function(e,s,t){"use strict";(function(e){function n(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(s,"__esModule",{value:!0});var o=t("JTVE"),i=function(){function e(e,s){for(var t=0;t<s.length;t++){var n=s[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(s,t,n){return t&&e(s.prototype,t),n&&e(s,n),s}}(),u=function(){function s(e){n(this,s),this.id=e,this.notes={},this.loading=!1,this.canResolve=!1}return i(s,[{key:"createNote",value:function(e){o.default.set(this.notes,e.noteId,new NoteModel(this.id,e))}},{key:"deleteNote",value:function(e){o.default.delete(this.notes,e)}},{key:"getNote",value:function(e){return this.notes[e]}},{key:"notesCount",value:function(){return Object.keys(this.notes).length}},{key:"isResolved",value:function(){for(var e in this.notes){if(!this.notes[e].resolved)return!1}return!0}},{key:"resolveAllNotes",value:function(e){for(var s in this.notes){var t=this.notes[s];t.resolved||(t.resolved=!0,t.resolved_by=e)}}},{key:"unResolveAllNotes",value:function(){for(var e in this.notes){var s=this.notes[e];s.resolved&&(s.resolved=!1,s.resolved_by=null)}}},{key:"updateHeadline",value:function(s){var t='.discussion[data-discussion-id="'+this.id+'"]',n=e(t+" .js-discussion-headline");s.discussion_headline_html?(n.length?n.replaceWith(s.discussion_headline_html):e(t+" .discussion-header").append(s.discussion_headline_html),gl.utils.localTimeAgo(e(".js-timeago",""+t))):n.remove()}},{key:"isResolvable",value:function(){if(!this.canResolve)return!1;for(var e in this.notes){if(this.notes[e].canResolve)return!0}return!1}}]),s}();window.DiscussionModel=u}).call(s,t("lwLq"))},cRac:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("JTVE");!function(e){e.ResolveCount=n.default.extend({mixins:[DiscussionMixins],props:{loggedOut:Boolean},data:function(){return{discussions:CommentsStore.state}},computed:{allResolved:function(){return this.resolvedDiscussionCount===this.discussionCount},resolvedCountText:function(){return 1===this.discussionCount?"discussion":"discussions"}}})}(window)},epgj:function(e,s){function t(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}var n=function e(s,n){t(this,e),this.discussionId=s,this.id=n.noteId,this.canResolve=n.canResolve,this.resolved=n.resolved,this.resolved_by=n.resolvedBy,this.authorName=n.authorName,this.authorAvatar=n.authorAvatar,this.noteTruncated=n.noteTruncated};window.NoteModel=n},"gL/p":function(e,s){e.exports='<svg width="11" height="11" viewBox="0 0 9 13"><path d="M2.57568253,6.49866948 C2.50548852,6.57199715 2.44637866,6.59708255 2.39835118,6.57392645 C2.3503237,6.55077034 2.32631032,6.48902165 2.32631032,6.38867852 L2.32631032,-2.13272614 C2.32631032,-2.23306927 2.3503237,-2.29481796 2.39835118,-2.31797406 C2.44637866,-2.34113017 2.50548852,-2.31604477 2.57568253,-2.24271709 L6.51022184,1.86747129 C6.53977721,1.8983461 6.56379059,1.93500939 6.5822627,1.97746225 L6.5822627,2.27849013 C6.56379059,2.31708364 6.53977721,2.35374693 6.51022184,2.38848109 L2.57568253,6.49866948 Z" transform="translate(4.454287, 2.127976) rotate(90.000000) translate(-4.454287, -2.127976) "></path><path d="M3.74312342,2.09553332 C3.74312342,1.99519019 3.77821989,1.9083561 3.8484139,1.83502843 C3.91860791,1.76170075 4.00173115,1.72503747 4.09778611,1.72503747 L4.80711151,1.72503747 C4.90316647,1.72503747 4.98628971,1.76170075 5.05648372,1.83502843 C5.12667773,1.9083561 5.16177421,1.99519019 5.16177421,2.09553332 L5.16177421,10.2464421 C5.16177421,10.3467853 5.12667773,10.4336194 5.05648372,10.506947 C4.98628971,10.5802747 4.90316647,10.616938 4.80711151,10.616938 L4.09778611,10.616938 C4.00173115,10.616938 3.91860791,10.5802747 3.8484139,10.506947 C3.77821989,10.4336194 3.74312342,10.3467853 3.74312342,10.2464421 L3.74312342,2.09553332 Z" transform="translate(4.452449, 6.170988) rotate(-90.000000) translate(-4.452449, -6.170988) "></path><path d="M2.57568253,14.6236695 C2.50548852,14.6969971 2.44637866,14.7220826 2.39835118,14.6989264 C2.3503237,14.6757703 2.32631032,14.6140216 2.32631032,14.5136785 L2.32631032,5.99227386 C2.32631032,5.89193073 2.3503237,5.83018204 2.39835118,5.80702594 C2.44637866,5.78386983 2.50548852,5.80895523 2.57568253,5.88228291 L6.51022184,9.99247129 C6.53977721,10.0233461 6.56379059,10.0600094 6.5822627,10.1024622 L6.5822627,10.4034901 C6.56379059,10.4420836 6.53977721,10.4787469 6.51022184,10.5134811 L2.57568253,14.6236695 Z" transform="translate(4.454287, 10.252976) scale(1, -1) rotate(90.000000) translate(-4.454287, -10.252976) "></path></svg>\n'},"rK+X":function(e,s,t){"use strict";(function(e){Object.defineProperty(s,"__esModule",{value:!0});var n=t("JTVE");!function(){var s=n.default.extend({props:{discussionId:String},data:function(){return{textareaIsEmpty:!0,discussion:{}}},computed:{showButton:function(){return!!this.discussion&&this.discussion.isResolvable()},isDiscussionResolved:function(){return this.discussion.isResolved()},buttonText:function(){return this.isDiscussionResolved?this.textareaIsEmpty?"Unresolve discussion":"Comment & unresolve discussion":this.textareaIsEmpty?"Resolve discussion":"Comment & resolve discussion"}},created:function(){this.discussionId&&(this.discussion=CommentsStore.state[this.discussionId])},mounted:function(){var s=this;if(this.discussionId){var t=e(".js-discussion-note-form[data-discussion-id="+this.discussionId+"] .note-textarea");this.textareaIsEmpty=""===t.val(),t.on("input.comment-and-resolve-btn",function(){s.textareaIsEmpty=""===t.val()})}},destroyed:function(){this.discussionId&&e(".js-discussion-note-form[data-discussion-id="+this.discussionId+"] .note-textarea").off("input.comment-and-resolve-btn")}});n.default.component("comment-and-resolve-btn",s)}(window)}).call(s,t("lwLq"))},tExy:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("JTVE");!function(){var e=n.default.extend({props:{discussionId:String,mergeRequestId:Number,canResolve:Boolean},data:function(){return{discussion:{}}},computed:{showButton:function(){return!!this.discussion&&this.discussion.isResolvable()},isDiscussionResolved:function(){return!!this.discussion&&this.discussion.isResolved()},buttonText:function(){return this.isDiscussionResolved?"Unresolve discussion":"Resolve discussion"},loading:function(){return!!this.discussion&&this.discussion.loading}},methods:{resolve:function(){ResolveService.toggleResolveForDiscussion(this.mergeRequestId,this.discussionId)}},created:function(){CommentsStore.createDiscussion(this.discussionId,this.canResolve),this.discussion=CommentsStore.state[this.discussionId]}});n.default.component("resolve-discussion-btn",e)}()},zKIA:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("JTVE");!function(e){e.CommentsStore={state:{},get:function(e,s){return this.state[e].getNote(s)},createDiscussion:function(e,s){var t=this.state[e];return this.state[e]||(t=new DiscussionModel(e),n.default.set(this.state,e,t)),void 0!==s&&(t.canResolve=s),t},create:function(e){this.createDiscussion(e.discussionId).createNote(e)},update:function(e,s,t,n){var o=this.state[e],i=o.getNote(s);i.resolved=t,i.resolved_by=n},delete:function(e,s){var t=this.state[e];t.deleteNote(s),0===t.notesCount()&&n.default.delete(this.state,e)},unresolvedDiscussionIds:function(){var e=[];for(var s in this.state){var t=this.state[s];t.isResolved()||e.push(t.id)}return e}}}(window)}},["EuiY"]);
//# sourceMappingURL=diff_notes.845808371f921616fde2.bundle.js.map